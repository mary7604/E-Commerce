@page "{id:int}"
@model WebApplication1.Pages.Admin.Orders.DetailsModel
@{
    ViewData["Title"] = "Détails Commande";
}

<div class="container-fluid px-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mt-4">
            <i class="fas fa-receipt"></i> Détails de la Commande
        </h1>
        <a href="/Admin/Orders" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Retour
        </a>
    </div>

    @if (Model.Commande == null)
    {
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> Commande introuvable
        </div>
    }
    else
    {
        <div class="row">
            <!-- Informations Commande -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-info-circle"></i> Informations Commande #@Model.Commande.Id
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <tr>
                                <th style="width: 30%;">Numéro</th>
                                <td><strong>#@Model.Commande.Id</strong></td>
                            </tr>
                            <tr>
                                <th>Date</th>
                                <td>@Model.Commande.DateCommande.ToString("dd/MM/yyyy HH:mm")</td>
                            </tr>
                            <tr>
                                <th>Client</th>
                                <td>
                                    @if (Model.Client != null)
                                    {
                                        <a href="/Admin/Customers/Details/@Model.Client.Id">
                                            @Model.Client.Nom (@Model.Client.Email)
                                        </a>
                                    }
                                    else
                                    {
                                        <span class="text-muted">Client inconnu</span>
                                    }
                                </td>
                            </tr>
                            <tr>
                                <th>Montant Total</th>
                                <td class="fs-4 text-danger">
                                    <strong>@Model.Commande.MontantTotal.ToString("N2") MAD</strong>
                                </td>
                            </tr>
                            <tr>
                                <th>Statut</th>
                                <td>
                                    <span class="badge bg-info fs-6">@Model.Commande.Statut</span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-cog"></i> Actions
                    </div>
                    <div class="card-body">
                        <form method="post" asp-page-handler="UpdateStatus">
                            <input type="hidden" name="id" value="@Model.Commande.Id" />

                            <div class="mb-3">
                                <label class="form-label">Changer le statut</label>
                                <select name="newStatus" class="form-select">
                                    <option value="En attente">En attente</option>
                                    <option value="Confirmée">Confirmée</option>
                                    <option value="En préparation">En préparation</option>
                                    <option value="Expédiée">Expédiée</option>
                                    <option value="Livrée">Livrée</option>
                                    <option value="Annulée">Annulée</option>
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary w-100 mb-2">
                                <i class="fas fa-save"></i> Mettre à jour
                            </button>
                        </form>

                        @if (Model.Client != null)
                        {
                            <a href="mailto:@Model.Client.Email" class="btn btn-outline-secondary w-100 mb-2">
                                <i class="fas fa-envelope"></i> Contacter le client
                            </a>
                        }

                        <a href="/Invoice?id=@Model.Commande.Id" target="_blank" class="btn btn-outline-primary w-100">
                            <i class="fas fa-file-pdf"></i> Télécharger la facture
                        </a>
                    </div>
                </div>

                <!-- Adresse de livraison -->
                @if (Model.Client != null && !string.IsNullOrEmpty(Model.Client.Adresse))
                {
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-map-marker-alt"></i> Adresse de livraison
                        </div>
                        <div class="card-body">
                            <p class="mb-0">@Model.Client.Adresse</p>
                            @if (!string.IsNullOrEmpty(Model.Client.Telephone))
                            {
                                <p class="mb-0 mt-2">
                                    <i class="fas fa-phone"></i> @Model.Client.Telephone
                                </p>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>